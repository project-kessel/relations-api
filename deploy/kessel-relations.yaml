apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: relations
objects:
  - apiVersion: v1
    kind: ConfigMap
    metadata:
      name: spicedb-schema
    data:
        schema.zed: "definition notifications/integration {\n\tpermission workspace = t_workspace\n\trelation t_workspace: rbac/workspace\n\tpermission view = t_workspace->notifications_integration_view\n\tpermission edit = t_workspace->notifications_integration_edit\n\tpermission test = t_workspace->notifications_integration_test\n\tpermission view_history = t_workspace->notifications_integration_view_history\n\tpermission delete = t_workspace->notifications_integration_delete\n\tpermission disable = t_workspace->notifications_integration_disable\n\tpermission enable = t_workspace->notifications_integration_enable\n}\n\ndefinition rbac/principal {}\n\ndefinition rbac/platform {\n\tpermission binding = t_binding\n\trelation t_binding: rbac/role_binding\n\tpermission notifications_integration_create = t_binding->notifications_integration_create\n\tpermission notifications_daily_digest_preference_edit = t_binding->notifications_daily_digest_preference_edit\n\tpermission notifications_daily_digest_preference_view = t_binding->notifications_daily_digest_preference_view\n\tpermission notifications_integration_subscribe_drawer = t_binding->notifications_integration_subscribe_drawer\n\tpermission notifications_integration_subscribe_email = t_binding->notifications_integration_subscribe_email\n\tpermission notifications_event_log_view = t_binding->notifications_event_log_view\n\tpermission notifications_behavior_groups_view = t_binding->notifications_behavior_groups_view\n\tpermission notifications_behavior_groups_edit = t_binding->notifications_behavior_groups_edit\n\tpermission notifications_bundles_view = t_binding->notifications_bundles_view\n\tpermission notifications_applications_view = t_binding->notifications_applications_view\n\tpermission notifications_event_types_view = t_binding->notifications_event_types_view\n\tpermission notifications_integration_view = t_binding->notifications_integration_view\n\tpermission notifications_integration_edit = t_binding->notifications_integration_edit\n\tpermission notifications_integration_test = t_binding->notifications_integration_test\n\tpermission notifications_integration_view_history = t_binding->notifications_integration_view_history\n\tpermission notifications_integration_delete = t_binding->notifications_integration_delete\n\tpermission notifications_integration_disable = t_binding->notifications_integration_disable\n\tpermission notifications_integration_enable = t_binding->notifications_integration_enable\n}\n\ndefinition rbac/tenant {\n\tpermission platform = t_platform\n\trelation t_platform: rbac/platform\n\tpermission binding = t_binding\n\trelation t_binding: rbac/role_binding\n\tpermission notifications_integration_create = t_binding->notifications_integration_create + t_platform->notifications_integration_create\n\tpermission notifications_daily_digest_preference_edit = t_binding->notifications_daily_digest_preference_edit + t_platform->notifications_daily_digest_preference_edit\n\tpermission notifications_daily_digest_preference_view = t_binding->notifications_daily_digest_preference_view + t_platform->notifications_daily_digest_preference_view\n\tpermission notifications_integration_subscribe_drawer = t_binding->notifications_integration_subscribe_drawer + t_platform->notifications_integration_subscribe_drawer\n\tpermission notifications_integration_subscribe_email = t_binding->notifications_integration_subscribe_email + t_platform->notifications_integration_subscribe_email\n\tpermission notifications_event_log_view = t_binding->notifications_event_log_view + t_platform->notifications_event_log_view\n\tpermission notifications_behavior_groups_view = t_binding->notifications_behavior_groups_view + t_platform->notifications_behavior_groups_view\n\tpermission notifications_behavior_groups_edit = t_binding->notifications_behavior_groups_edit + t_platform->notifications_behavior_groups_edit\n\tpermission notifications_bundles_view = t_binding->notifications_bundles_view + t_platform->notifications_bundles_view\n\tpermission notifications_applications_view = t_binding->notifications_applications_view + t_platform->notifications_applications_view\n\tpermission notifications_event_types_view = t_binding->notifications_event_types_view + t_platform->notifications_event_types_view\n\tpermission notifications_integration_view = t_binding->notifications_integration_view + t_platform->notifications_integration_view\n\tpermission notifications_integration_edit = t_binding->notifications_integration_edit + t_platform->notifications_integration_edit\n\tpermission notifications_integration_test = t_binding->notifications_integration_test + t_platform->notifications_integration_test\n\tpermission notifications_integration_view_history = t_binding->notifications_integration_view_history + t_platform->notifications_integration_view_history\n\tpermission notifications_integration_delete = t_binding->notifications_integration_delete + t_platform->notifications_integration_delete\n\tpermission notifications_integration_disable = t_binding->notifications_integration_disable + t_platform->notifications_integration_disable\n\tpermission notifications_integration_enable = t_binding->notifications_integration_enable + t_platform->notifications_integration_enable\n}\n\ndefinition rbac/group {\n\tpermission owner = t_owner\n\trelation t_owner: rbac/tenant\n\tpermission member = t_member\n\trelation t_member: rbac/principal | rbac/group#member\n}\n\ndefinition rbac/role {\n\tpermission all_all_all = t_all_all_all\n\trelation t_all_all_all: rbac/principal:*\n\tpermission child = t_child\n\trelation t_child: rbac/role\n\tpermission integrations_all_all = t_integrations_all_all\n\trelation t_integrations_all_all: rbac/principal:*\n\tpermission integrations_endpoints_all = t_integrations_endpoints_all\n\trelation t_integrations_endpoints_all: rbac/principal:*\n\tpermission integrations_all_write = t_integrations_all_write\n\trelation t_integrations_all_write: rbac/principal:*\n\tpermission integrations_endpoints_write = t_integrations_endpoints_write\n\trelation t_integrations_endpoints_write: rbac/principal:*\n\tpermission notifications_integration_create = integrations_endpoints_write + integrations_endpoints_all + integrations_all_write + integrations_all_all + all_all_all + t_child->notifications_integration_create\n\tpermission notifications_all_all = t_notifications_all_all\n\trelation t_notifications_all_all: rbac/principal:*\n\tpermission notifications_notifications_all = t_notifications_notifications_all\n\trelation t_notifications_notifications_all: rbac/principal:*\n\tpermission notifications_all_write = t_notifications_all_write\n\trelation t_notifications_all_write: rbac/principal:*\n\tpermission notifications_notifications_write = t_notifications_notifications_write\n\trelation t_notifications_notifications_write: rbac/principal:*\n\tpermission notifications_daily_digest_preference_edit = notifications_notifications_write + notifications_notifications_all + notifications_all_write + notifications_all_all + all_all_all + t_child->notifications_daily_digest_preference_edit\n\tpermission notifications_all_read = t_notifications_all_read\n\trelation t_notifications_all_read: rbac/principal:*\n\tpermission notifications_notifications_read = t_notifications_notifications_read\n\trelation t_notifications_notifications_read: rbac/principal:*\n\tpermission notifications_daily_digest_preference_view = notifications_notifications_read + notifications_notifications_all + notifications_all_read + notifications_all_all + all_all_all + t_child->notifications_daily_digest_preference_view\n\tpermission integrations_all_read = t_integrations_all_read\n\trelation t_integrations_all_read: rbac/principal:*\n\tpermission integrations_endpoints_read = t_integrations_endpoints_read\n\trelation t_integrations_endpoints_read: rbac/principal:*\n\tpermission notifications_integration_subscribe_drawer = integrations_endpoints_read + integrations_endpoints_all + integrations_all_read + integrations_all_all + all_all_all + t_child->notifications_integration_subscribe_drawer\n\tpermission notifications_integration_subscribe_email = integrations_endpoints_read + integrations_endpoints_all + integrations_all_read + integrations_all_all + all_all_all + t_child->notifications_integration_subscribe_email\n\tpermission notifications_events_all = t_notifications_events_all\n\trelation t_notifications_events_all: rbac/principal:*\n\tpermission notifications_events_read = t_notifications_events_read\n\trelation t_notifications_events_read: rbac/principal:*\n\tpermission notifications_event_log_view = notifications_events_read + notifications_events_all + notifications_all_read + notifications_all_all + all_all_all + t_child->notifications_event_log_view\n\tpermission notifications_behavior_groups_view = notifications_notifications_read + notifications_notifications_all + notifications_all_read + notifications_all_all + all_all_all + t_child->notifications_behavior_groups_view\n\tpermission notifications_behavior_groups_edit = notifications_notifications_write + notifications_notifications_all + notifications_all_write + notifications_all_all + all_all_all + t_child->notifications_behavior_groups_edit\n\tpermission notifications_bundles_view = notifications_notifications_read + notifications_notifications_all + notifications_all_read + notifications_all_all + all_all_all + t_child->notifications_bundles_view\n\tpermission notifications_applications_view = notifications_notifications_read + notifications_notifications_all + notifications_all_read + notifications_all_all + all_all_all + t_child->notifications_applications_view\n\tpermission notifications_event_types_view = notifications_notifications_read + notifications_notifications_all + notifications_all_read + notifications_all_all + all_all_all + t_child->notifications_event_types_view\n\tpermission notifications_integration_view = integrations_endpoints_read + integrations_endpoints_all + integrations_all_read + integrations_all_all + all_all_all + t_child->notifications_integration_view\n\tpermission notifications_integration_edit = integrations_endpoints_write + integrations_endpoints_all + integrations_all_write + integrations_all_all + all_all_all + t_child->notifications_integration_edit\n\tpermission notifications_integration_test = integrations_endpoints_write + integrations_endpoints_all + integrations_all_write + integrations_all_all + all_all_all + t_child->notifications_integration_test\n\tpermission notifications_integration_view_history = integrations_endpoints_read + integrations_endpoints_all + integrations_all_read + integrations_all_all + all_all_all + t_child->notifications_integration_view_history\n\tpermission notifications_integration_delete = integrations_endpoints_write + integrations_endpoints_all + integrations_all_write + integrations_all_all + all_all_all + t_child->notifications_integration_delete\n\tpermission notifications_integration_disable = integrations_endpoints_write + integrations_endpoints_all + integrations_all_write + integrations_all_all + all_all_all + t_child->notifications_integration_disable\n\tpermission notifications_integration_enable = integrations_endpoints_write + integrations_endpoints_all + integrations_all_write + integrations_all_all + all_all_all + t_child->notifications_integration_enable\n\tpermission advisor_all_read = t_advisor_all_read\n\trelation t_advisor_all_read: rbac/principal:*\n\tpermission advisor_all_all = t_advisor_all_all\n\trelation t_advisor_all_all: rbac/principal:*\n\tpermission advisor_disable_recommendations_write = t_advisor_disable_recommendations_write\n\trelation t_advisor_disable_recommendations_write: rbac/principal:*\n\tpermission advisor_exports_read = t_advisor_exports_read\n\trelation t_advisor_exports_read: rbac/principal:*\n\tpermission advisor_recommendation_results_read = t_advisor_recommendation_results_read\n\trelation t_advisor_recommendation_results_read: rbac/principal:*\n\tpermission advisor_weekly_email_read = t_advisor_weekly_email_read\n\trelation t_advisor_weekly_email_read: rbac/principal:*\n\tpermission ansible_wisdom_admin_dashboard_chart_active_users_read = t_ansible_wisdom_admin_dashboard_chart_active_users_read\n\trelation t_ansible_wisdom_admin_dashboard_chart_active_users_read: rbac/principal:*\n\tpermission ansible_wisdom_admin_dashboard_chart_module_usage_read = t_ansible_wisdom_admin_dashboard_chart_module_usage_read\n\trelation t_ansible_wisdom_admin_dashboard_chart_module_usage_read: rbac/principal:*\n\tpermission ansible_wisdom_admin_dashboard_chart_recommendations_read = t_ansible_wisdom_admin_dashboard_chart_recommendations_read\n\trelation t_ansible_wisdom_admin_dashboard_chart_recommendations_read: rbac/principal:*\n\tpermission ansible_wisdom_admin_dashboard_chart_user_sentiment_read = t_ansible_wisdom_admin_dashboard_chart_user_sentiment_read\n\trelation t_ansible_wisdom_admin_dashboard_chart_user_sentiment_read: rbac/principal:*\n\tpermission automation_analytics_all_read = t_automation_analytics_all_read\n\trelation t_automation_analytics_all_read: rbac/principal:*\n\tpermission automation_analytics_all_write = t_automation_analytics_all_write\n\trelation t_automation_analytics_all_write: rbac/principal:*\n\tpermission automation_analytics_all_all = t_automation_analytics_all_all\n\trelation t_automation_analytics_all_all: rbac/principal:*\n\tpermission compliance_all_all = t_compliance_all_all\n\trelation t_compliance_all_all: rbac/principal:*\n\tpermission compliance_policy_read = t_compliance_policy_read\n\trelation t_compliance_policy_read: rbac/principal:*\n\tpermission compliance_policy_create = t_compliance_policy_create\n\trelation t_compliance_policy_create: rbac/principal:*\n\tpermission compliance_policy_update = t_compliance_policy_update\n\trelation t_compliance_policy_update: rbac/principal:*\n\tpermission compliance_policy_delete = t_compliance_policy_delete\n\trelation t_compliance_policy_delete: rbac/principal:*\n\tpermission compliance_policy_write = t_compliance_policy_write\n\trelation t_compliance_policy_write: rbac/principal:*\n\tpermission compliance_report_read = t_compliance_report_read\n\trelation t_compliance_report_read: rbac/principal:*\n\tpermission compliance_report_delete = t_compliance_report_delete\n\trelation t_compliance_report_delete: rbac/principal:*\n\tpermission compliance_system_read = t_compliance_system_read\n\trelation t_compliance_system_read: rbac/principal:*\n\tpermission config_manager_activation_keys_read = t_config_manager_activation_keys_read\n\trelation t_config_manager_activation_keys_read: rbac/principal:*\n\tpermission config_manager_activation_keys_write = t_config_manager_activation_keys_write\n\trelation t_config_manager_activation_keys_write: rbac/principal:*\n\tpermission config_manager_activation_keys_all = t_config_manager_activation_keys_all\n\trelation t_config_manager_activation_keys_all: rbac/principal:*\n\tpermission config_manager_state_read = t_config_manager_state_read\n\trelation t_config_manager_state_read: rbac/principal:*\n\tpermission config_manager_state_write = t_config_manager_state_write\n\trelation t_config_manager_state_write: rbac/principal:*\n\tpermission config_manager_state_changes_read = t_config_manager_state_changes_read\n\trelation t_config_manager_state_changes_read: rbac/principal:*\n\tpermission content_sources_all_all = t_content_sources_all_all\n\trelation t_content_sources_all_all: rbac/principal:*\n\tpermission content_sources_repositories_read = t_content_sources_repositories_read\n\trelation t_content_sources_repositories_read: rbac/principal:*\n\tpermission content_sources_repositories_write = t_content_sources_repositories_write\n\trelation t_content_sources_repositories_write: rbac/principal:*\n\tpermission content_sources_repositories_upload = t_content_sources_repositories_upload\n\trelation t_content_sources_repositories_upload: rbac/principal:*\n\tpermission content_sources_templates_read = t_content_sources_templates_read\n\trelation t_content_sources_templates_read: rbac/principal:*\n\tpermission content_sources_templates_write = t_content_sources_templates_write\n\trelation t_content_sources_templates_write: rbac/principal:*\n\tpermission cost_management_all_all = t_cost_management_all_all\n\trelation t_cost_management_all_all: rbac/principal:*\n\tpermission cost_management_aws_account_all = t_cost_management_aws_account_all\n\trelation t_cost_management_aws_account_all: rbac/principal:*\n\tpermission cost_management_aws_account_read = t_cost_management_aws_account_read\n\trelation t_cost_management_aws_account_read: rbac/principal:*\n\tpermission cost_management_aws_organizational_unit_all = t_cost_management_aws_organizational_unit_all\n\trelation t_cost_management_aws_organizational_unit_all: rbac/principal:*\n\tpermission cost_management_aws_organizational_unit_read = t_cost_management_aws_organizational_unit_read\n\trelation t_cost_management_aws_organizational_unit_read: rbac/principal:*\n\tpermission cost_management_azure_subscription_guid_all = t_cost_management_azure_subscription_guid_all\n\trelation t_cost_management_azure_subscription_guid_all: rbac/principal:*\n\tpermission cost_management_azure_subscription_guid_read = t_cost_management_azure_subscription_guid_read\n\trelation t_cost_management_azure_subscription_guid_read: rbac/principal:*\n\tpermission cost_management_cost_model_all = t_cost_management_cost_model_all\n\trelation t_cost_management_cost_model_all: rbac/principal:*\n\tpermission cost_management_cost_model_read = t_cost_management_cost_model_read\n\trelation t_cost_management_cost_model_read: rbac/principal:*\n\tpermission cost_management_cost_model_write = t_cost_management_cost_model_write\n\trelation t_cost_management_cost_model_write: rbac/principal:*\n\tpermission cost_management_gcp_account_all = t_cost_management_gcp_account_all\n\trelation t_cost_management_gcp_account_all: rbac/principal:*\n\tpermission cost_management_gcp_account_read = t_cost_management_gcp_account_read\n\trelation t_cost_management_gcp_account_read: rbac/principal:*\n\tpermission cost_management_gcp_project_all = t_cost_management_gcp_project_all\n\trelation t_cost_management_gcp_project_all: rbac/principal:*\n\tpermission cost_management_gcp_project_read = t_cost_management_gcp_project_read\n\trelation t_cost_management_gcp_project_read: rbac/principal:*\n\tpermission cost_management_oci_payer_tenant_id_all = t_cost_management_oci_payer_tenant_id_all\n\trelation t_cost_management_oci_payer_tenant_id_all: rbac/principal:*\n\tpermission cost_management_oci_payer_tenant_id_read = t_cost_management_oci_payer_tenant_id_read\n\trelation t_cost_management_oci_payer_tenant_id_read: rbac/principal:*\n\tpermission cost_management_openshift_cluster_all = t_cost_management_openshift_cluster_all\n\trelation t_cost_management_openshift_cluster_all: rbac/principal:*\n\tpermission cost_management_openshift_cluster_read = t_cost_management_openshift_cluster_read\n\trelation t_cost_management_openshift_cluster_read: rbac/principal:*\n\tpermission cost_management_openshift_node_all = t_cost_management_openshift_node_all\n\trelation t_cost_management_openshift_node_all: rbac/principal:*\n\tpermission cost_management_openshift_node_read = t_cost_management_openshift_node_read\n\trelation t_cost_management_openshift_node_read: rbac/principal:*\n\tpermission cost_management_openshift_project_all = t_cost_management_openshift_project_all\n\trelation t_cost_management_openshift_project_all: rbac/principal:*\n\tpermission cost_management_openshift_project_read = t_cost_management_openshift_project_read\n\trelation t_cost_management_openshift_project_read: rbac/principal:*\n\tpermission cost_management_settings_all = t_cost_management_settings_all\n\trelation t_cost_management_settings_all: rbac/principal:*\n\tpermission cost_management_settings_read = t_cost_management_settings_read\n\trelation t_cost_management_settings_read: rbac/principal:*\n\tpermission cost_management_settings_write = t_cost_management_settings_write\n\trelation t_cost_management_settings_write: rbac/principal:*\n\tpermission hybrid_committed_spend_reports_read = t_hybrid_committed_spend_reports_read\n\trelation t_hybrid_committed_spend_reports_read: rbac/principal:*\n\tpermission idmsvc_all_all = t_idmsvc_all_all\n\trelation t_idmsvc_all_all: rbac/principal:*\n\tpermission idmsvc_domains_list = t_idmsvc_domains_list\n\trelation t_idmsvc_domains_list: rbac/principal:*\n\tpermission idmsvc_domains_read = t_idmsvc_domains_read\n\trelation t_idmsvc_domains_read: rbac/principal:*\n\tpermission idmsvc_domains_create = t_idmsvc_domains_create\n\trelation t_idmsvc_domains_create: rbac/principal:*\n\tpermission idmsvc_domains_update = t_idmsvc_domains_update\n\trelation t_idmsvc_domains_update: rbac/principal:*\n\tpermission idmsvc_domains_delete = t_idmsvc_domains_delete\n\trelation t_idmsvc_domains_delete: rbac/principal:*\n\tpermission idmsvc_token_create = t_idmsvc_token_create\n\trelation t_idmsvc_token_create: rbac/principal:*\n\tpermission inventory_all_read = t_inventory_all_read\n\trelation t_inventory_all_read: rbac/principal:*\n\tpermission inventory_all_all = t_inventory_all_all\n\trelation t_inventory_all_all: rbac/principal:*\n\tpermission inventory_groups_read = t_inventory_groups_read\n\trelation t_inventory_groups_read: rbac/principal:*\n\tpermission inventory_groups_write = t_inventory_groups_write\n\trelation t_inventory_groups_write: rbac/principal:*\n\tpermission inventory_groups_all = t_inventory_groups_all\n\trelation t_inventory_groups_all: rbac/principal:*\n\tpermission inventory_hosts_read = t_inventory_hosts_read\n\trelation t_inventory_hosts_read: rbac/principal:*\n\tpermission inventory_hosts_write = t_inventory_hosts_write\n\trelation t_inventory_hosts_write: rbac/principal:*\n\tpermission inventory_hosts_all = t_inventory_hosts_all\n\trelation t_inventory_hosts_all: rbac/principal:*\n\tpermission malware_detection_all_all = t_malware_detection_all_all\n\trelation t_malware_detection_all_all: rbac/principal:*\n\tpermission malware_detection_all_read = t_malware_detection_all_read\n\trelation t_malware_detection_all_read: rbac/principal:*\n\tpermission malware_detection_acknowledgements_write = t_malware_detection_acknowledgements_write\n\trelation t_malware_detection_acknowledgements_write: rbac/principal:*\n\tpermission ocp_advisor_all_all = t_ocp_advisor_all_all\n\trelation t_ocp_advisor_all_all: rbac/principal:*\n\tpermission ocp_advisor_exports_read = t_ocp_advisor_exports_read\n\trelation t_ocp_advisor_exports_read: rbac/principal:*\n\tpermission ocp_advisor_recommendation_results_read = t_ocp_advisor_recommendation_results_read\n\trelation t_ocp_advisor_recommendation_results_read: rbac/principal:*\n\tpermission ocp_advisor_toggle_recommendations_write = t_ocp_advisor_toggle_recommendations_write\n\trelation t_ocp_advisor_toggle_recommendations_write: rbac/principal:*\n\tpermission patch_all_all = t_patch_all_all\n\trelation t_patch_all_all: rbac/principal:*\n\tpermission patch_all_read = t_patch_all_read\n\trelation t_patch_all_read: rbac/principal:*\n\tpermission patch_all_write = t_patch_all_write\n\trelation t_patch_all_write: rbac/principal:*\n\tpermission patch_system_write = t_patch_system_write\n\trelation t_patch_system_write: rbac/principal:*\n\tpermission patch_template_write = t_patch_template_write\n\trelation t_patch_template_write: rbac/principal:*\n\tpermission playbook_dispatcher_run_read = t_playbook_dispatcher_run_read\n\trelation t_playbook_dispatcher_run_read: rbac/principal:*\n\tpermission playbook_dispatcher_run_write = t_playbook_dispatcher_run_write\n\trelation t_playbook_dispatcher_run_write: rbac/principal:*\n\tpermission policies_all_all = t_policies_all_all\n\trelation t_policies_all_all: rbac/principal:*\n\tpermission policies_policies_read = t_policies_policies_read\n\trelation t_policies_policies_read: rbac/principal:*\n\tpermission policies_policies_write = t_policies_policies_write\n\trelation t_policies_policies_write: rbac/principal:*\n\tpermission provisioning_all_all = t_provisioning_all_all\n\trelation t_provisioning_all_all: rbac/principal:*\n\tpermission provisioning_pubkey_all = t_provisioning_pubkey_all\n\trelation t_provisioning_pubkey_all: rbac/principal:*\n\tpermission provisioning_pubkey_read = t_provisioning_pubkey_read\n\trelation t_provisioning_pubkey_read: rbac/principal:*\n\tpermission provisioning_pubkey_write = t_provisioning_pubkey_write\n\trelation t_provisioning_pubkey_write: rbac/principal:*\n\tpermission provisioning_reservation_all = t_provisioning_reservation_all\n\trelation t_provisioning_reservation_all: rbac/principal:*\n\tpermission provisioning_reservation_read = t_provisioning_reservation_read\n\trelation t_provisioning_reservation_read: rbac/principal:*\n\tpermission provisioning_reservation_write = t_provisioning_reservation_write\n\trelation t_provisioning_reservation_write: rbac/principal:*\n\tpermission provisioning_reservation_aws_all = t_provisioning_reservation_aws_all\n\trelation t_provisioning_reservation_aws_all: rbac/principal:*\n\tpermission provisioning_reservation_aws_read = t_provisioning_reservation_aws_read\n\trelation t_provisioning_reservation_aws_read: rbac/principal:*\n\tpermission provisioning_reservation_aws_write = t_provisioning_reservation_aws_write\n\trelation t_provisioning_reservation_aws_write: rbac/principal:*\n\tpermission provisioning_reservation_azure_all = t_provisioning_reservation_azure_all\n\trelation t_provisioning_reservation_azure_all: rbac/principal:*\n\tpermission provisioning_reservation_azure_read = t_provisioning_reservation_azure_read\n\trelation t_provisioning_reservation_azure_read: rbac/principal:*\n\tpermission provisioning_reservation_azure_write = t_provisioning_reservation_azure_write\n\trelation t_provisioning_reservation_azure_write: rbac/principal:*\n\tpermission provisioning_reservation_gcp_all = t_provisioning_reservation_gcp_all\n\trelation t_provisioning_reservation_gcp_all: rbac/principal:*\n\tpermission provisioning_reservation_gcp_read = t_provisioning_reservation_gcp_read\n\trelation t_provisioning_reservation_gcp_read: rbac/principal:*\n\tpermission provisioning_reservation_gcp_write = t_provisioning_reservation_gcp_write\n\trelation t_provisioning_reservation_gcp_write: rbac/principal:*\n\tpermission provisioning_source_all = t_provisioning_source_all\n\trelation t_provisioning_source_all: rbac/principal:*\n\tpermission provisioning_source_read = t_provisioning_source_read\n\trelation t_provisioning_source_read: rbac/principal:*\n\tpermission rbac_all_all = t_rbac_all_all\n\trelation t_rbac_all_all: rbac/principal:*\n\tpermission rbac_principal_read = t_rbac_principal_read\n\trelation t_rbac_principal_read: rbac/principal:*\n\tpermission remediations_all_all = t_remediations_all_all\n\trelation t_remediations_all_all: rbac/principal:*\n\tpermission remediations_all_read = t_remediations_all_read\n\trelation t_remediations_all_read: rbac/principal:*\n\tpermission remediations_all_write = t_remediations_all_write\n\trelation t_remediations_all_write: rbac/principal:*\n\tpermission remediations_remediation_read = t_remediations_remediation_read\n\trelation t_remediations_remediation_read: rbac/principal:*\n\tpermission remediations_remediation_write = t_remediations_remediation_write\n\trelation t_remediations_remediation_write: rbac/principal:*\n\tpermission remediations_remediation_execute = t_remediations_remediation_execute\n\trelation t_remediations_remediation_execute: rbac/principal:*\n\tpermission ros_all_all = t_ros_all_all\n\trelation t_ros_all_all: rbac/principal:*\n\tpermission ros_all_read = t_ros_all_read\n\trelation t_ros_all_read: rbac/principal:*\n\tpermission sources_all_all = t_sources_all_all\n\trelation t_sources_all_all: rbac/principal:*\n\tpermission staleness_staleness_read = t_staleness_staleness_read\n\trelation t_staleness_staleness_read: rbac/principal:*\n\tpermission staleness_staleness_write = t_staleness_staleness_write\n\trelation t_staleness_staleness_write: rbac/principal:*\n\tpermission staleness_staleness_all = t_staleness_staleness_all\n\trelation t_staleness_staleness_all: rbac/principal:*\n\tpermission subscriptions_all_all = t_subscriptions_all_all\n\trelation t_subscriptions_all_all: rbac/principal:*\n\tpermission subscriptions_cloud_access_read = t_subscriptions_cloud_access_read\n\trelation t_subscriptions_cloud_access_read: rbac/principal:*\n\tpermission subscriptions_cloud_access_write = t_subscriptions_cloud_access_write\n\trelation t_subscriptions_cloud_access_write: rbac/principal:*\n\tpermission subscriptions_manifests_read = t_subscriptions_manifests_read\n\trelation t_subscriptions_manifests_read: rbac/principal:*\n\tpermission subscriptions_manifests_write = t_subscriptions_manifests_write\n\trelation t_subscriptions_manifests_write: rbac/principal:*\n\tpermission subscriptions_organization_read = t_subscriptions_organization_read\n\trelation t_subscriptions_organization_read: rbac/principal:*\n\tpermission subscriptions_organization_write = t_subscriptions_organization_write\n\trelation t_subscriptions_organization_write: rbac/principal:*\n\tpermission subscriptions_products_read = t_subscriptions_products_read\n\trelation t_subscriptions_products_read: rbac/principal:*\n\tpermission subscriptions_products_write = t_subscriptions_products_write\n\trelation t_subscriptions_products_write: rbac/principal:*\n\tpermission subscriptions_reports_read = t_subscriptions_reports_read\n\trelation t_subscriptions_reports_read: rbac/principal:*\n\tpermission tasks_all_all = t_tasks_all_all\n\trelation t_tasks_all_all: rbac/principal:*\n\tpermission vulnerability_all_read = t_vulnerability_all_read\n\trelation t_vulnerability_all_read: rbac/principal:*\n\tpermission vulnerability_all_write = t_vulnerability_all_write\n\trelation t_vulnerability_all_write: rbac/principal:*\n\tpermission vulnerability_all_all = t_vulnerability_all_all\n\trelation t_vulnerability_all_all: rbac/principal:*\n\tpermission vulnerability_advanced_report_read = t_vulnerability_advanced_report_read\n\trelation t_vulnerability_advanced_report_read: rbac/principal:*\n\tpermission vulnerability_cve_business_risk_and_status_write = t_vulnerability_cve_business_risk_and_status_write\n\trelation t_vulnerability_cve_business_risk_and_status_write: rbac/principal:*\n\tpermission vulnerability_report_and_export_read = t_vulnerability_report_and_export_read\n\trelation t_vulnerability_report_and_export_read: rbac/principal:*\n\tpermission vulnerability_system_cve_status_write = t_vulnerability_system_cve_status_write\n\trelation t_vulnerability_system_cve_status_write: rbac/principal:*\n\tpermission vulnerability_system_opt_out_write = t_vulnerability_system_opt_out_write\n\trelation t_vulnerability_system_opt_out_write: rbac/principal:*\n\tpermission vulnerability_system_opt_out_read = t_vulnerability_system_opt_out_read\n\trelation t_vulnerability_system_opt_out_read: rbac/principal:*\n\tpermission vulnerability_toggle_cves_without_errata_write = t_vulnerability_toggle_cves_without_errata_write\n\trelation t_vulnerability_toggle_cves_without_errata_write: rbac/principal:*\n\tpermission vulnerability_vulnerability_results_read = t_vulnerability_vulnerability_results_read\n\trelation t_vulnerability_vulnerability_results_read: rbac/principal:*\n}\n\ndefinition rbac/role_binding {\n\tpermission subject = t_subject\n\trelation t_subject: rbac/principal | rbac/group#member\n\tpermission role = t_role\n\trelation t_role: rbac/role\n\tpermission notifications_integration_create = (subject & t_role->notifications_integration_create)\n\tpermission notifications_daily_digest_preference_edit = (subject & t_role->notifications_daily_digest_preference_edit)\n\tpermission notifications_daily_digest_preference_view = (subject & t_role->notifications_daily_digest_preference_view)\n\tpermission notifications_integration_subscribe_drawer = (subject & t_role->notifications_integration_subscribe_drawer)\n\tpermission notifications_integration_subscribe_email = (subject & t_role->notifications_integration_subscribe_email)\n\tpermission notifications_event_log_view = (subject & t_role->notifications_event_log_view)\n\tpermission notifications_behavior_groups_view = (subject & t_role->notifications_behavior_groups_view)\n\tpermission notifications_behavior_groups_edit = (subject & t_role->notifications_behavior_groups_edit)\n\tpermission notifications_bundles_view = (subject & t_role->notifications_bundles_view)\n\tpermission notifications_applications_view = (subject & t_role->notifications_applications_view)\n\tpermission notifications_event_types_view = (subject & t_role->notifications_event_types_view)\n\tpermission notifications_integration_view = (subject & t_role->notifications_integration_view)\n\tpermission notifications_integration_edit = (subject & t_role->notifications_integration_edit)\n\tpermission notifications_integration_test = (subject & t_role->notifications_integration_test)\n\tpermission notifications_integration_view_history = (subject & t_role->notifications_integration_view_history)\n\tpermission notifications_integration_delete = (subject & t_role->notifications_integration_delete)\n\tpermission notifications_integration_disable = (subject & t_role->notifications_integration_disable)\n\tpermission notifications_integration_enable = (subject & t_role->notifications_integration_enable)\n}\n\ndefinition rbac/workspace {\n\tpermission parent = t_parent\n\trelation t_parent: rbac/workspace | rbac/tenant\n\tpermission binding = t_binding\n\trelation t_binding: rbac/role_binding\n\tpermission notifications_integration_create = t_binding->notifications_integration_create + t_parent->notifications_integration_create\n\tpermission notifications_daily_digest_preference_edit = t_binding->notifications_daily_digest_preference_edit + t_parent->notifications_daily_digest_preference_edit\n\tpermission notifications_daily_digest_preference_view = t_binding->notifications_daily_digest_preference_view + t_parent->notifications_daily_digest_preference_view\n\tpermission notifications_integration_subscribe_drawer = t_binding->notifications_integration_subscribe_drawer + t_parent->notifications_integration_subscribe_drawer\n\tpermission notifications_integration_subscribe_email = t_binding->notifications_integration_subscribe_email + t_parent->notifications_integration_subscribe_email\n\tpermission notifications_event_log_view = t_binding->notifications_event_log_view + t_parent->notifications_event_log_view\n\tpermission notifications_behavior_groups_view = t_binding->notifications_behavior_groups_view + t_parent->notifications_behavior_groups_view\n\tpermission notifications_behavior_groups_edit = t_binding->notifications_behavior_groups_edit + t_parent->notifications_behavior_groups_edit\n\tpermission notifications_bundles_view = t_binding->notifications_bundles_view + t_parent->notifications_bundles_view\n\tpermission notifications_applications_view = t_binding->notifications_applications_view + t_parent->notifications_applications_view\n\tpermission notifications_event_types_view = t_binding->notifications_event_types_view + t_parent->notifications_event_types_view\n\tpermission notifications_integration_view = t_binding->notifications_integration_view + t_parent->notifications_integration_view\n\tpermission notifications_integration_edit = t_binding->notifications_integration_edit + t_parent->notifications_integration_edit\n\tpermission notifications_integration_test = t_binding->notifications_integration_test + t_parent->notifications_integration_test\n\tpermission notifications_integration_view_history = t_binding->notifications_integration_view_history + t_parent->notifications_integration_view_history\n\tpermission notifications_integration_delete = t_binding->notifications_integration_delete + t_parent->notifications_integration_delete\n\tpermission notifications_integration_disable = t_binding->notifications_integration_disable + t_parent->notifications_integration_disable\n\tpermission notifications_integration_enable = t_binding->notifications_integration_enable + t_parent->notifications_integration_enable\n}"
  - apiVersion: v1
    kind: ConfigMap
    metadata:
      name: relations-api-config
    data:
      config.yaml: |
        server:
          http:
            addr: "${HTTPADDR:0.0.0.0:8000}"
            timeout: 1s
            pathprefix: "/api/authz"
          grpc:
            addr: "${GRPCADDR:0.0.0.0:9000}"
            timeout: 30s
          minLogLevel: Info
          auth:
            enableAuth: "${ENABLEAUTH:false}"
            jwksUrl: "${JWKSURL:http://0.0.0.0:8180/jwks}"
        data:
          spiceDb:
            useTLS: false
            endpoint: "${ENDPOINT:0.0.0.0:50051}"
            token: "${PRESHARED}" # token takes precedence over tokenFile
            tokenFile: "${PRESHARED_FILE:.secrets/local-spicedb-secret}"
            schemaFile: "${SCHEMA_FILE:deploy/schema.zed}"
            fullyConsistent: true
  - apiVersion: v1
    kind: Secret
    metadata:
      name: postgres-secret
    stringData:
      POSTGRESQL_DATABASE: authz
      POSTGRESQL_USER: authz
      POSTGRESQL_PASSWORD: SuperSecretPassword
  - apiVersion: v1
    kind: Secret
    metadata:
      name: dev-spicedb-config
    stringData:
      preshared_key: "averysecretpresharedkey"
      datastore_uri: postgres://authz:SuperSecretPassword@postgres:5432/authz?sslmode=disable
  - apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: postgres
      name: postgres
    spec:
      selector:
        matchLabels:
          app: postgres
      template:
        metadata:
          labels:
            app: postgres
        spec:
          containers:
          - env:
            - name: POSTGRESQL_DATABASE
              valueFrom:
                secretKeyRef:
                  name: postgres-secret
                  key: POSTGRESQL_DATABASE
            - name: POSTGRESQL_USER
              valueFrom:
                secretKeyRef:
                  name: postgres-secret
                  key: POSTGRESQL_USER
            - name: POSTGRESQL_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: postgres-secret
                  key: POSTGRESQL_PASSWORD
            - name: PGDATA
              value: /temp/data
            image: registry.redhat.io/rhel9/postgresql-15:1-54
            imagePullPolicy: Always
            name: postgres
            ports:
            - containerPort: 5432
              protocol: TCP
            resources:
              limits:
                cpu: 60m
                memory: 256Mi
              requests:
                cpu: 30m
                memory: 128Mi
          restartPolicy: Always
  - apiVersion: v1
    kind: Service
    metadata:
      labels:
        app: postgres
      name: postgres
    spec:
      ports:
      - name: http
        port: 5432
        protocol: TCP
      selector:
        app: postgres
  - apiVersion: authzed.com/v1alpha1
    kind: SpiceDBCluster
    metadata:
      name: relations-spicedb
    spec:
      config:
        logLevel: debug
        replicas: ${{SPICEDB_REPLICAS}}
        datastoreEngine: postgres
        image: ${{SPICEDB_IMAGE}}
      secretName: dev-spicedb-config
      patches:
      - kind: Deployment
        patch:
          spec:
            template:
              spec:
                containers:
                - name: spicedb
                  resources:
                    requests:
                      memory: "128Mi"
                      cpu: "25m"
                    limits:
                      memory: "256Mi"
                      cpu: "100m"
  - apiVersion: cloud.redhat.com/v1alpha1
    kind: ClowdApp
    metadata:
      name: kessel-relations
    spec:
      envName: ${ENV_NAME}
      testing:
        iqePlugin: relations_api
      deployments:
        - name: api
          minReplicas: ${{RELATIONS_REPLICAS}}
          podSpec:
            image: ${RELATIONS_IMAGE}:${RELATIONS_IMAGE_TAG}
            livenessProbe:
              httpGet:
                path: /api/authz/livez
                port: 8000
            readinessProbe:
              httpGet:
                path: /api/authz/readyz
                port: 8000
            env:
              - name: SPICEDB_PRESHARED
                valueFrom:
                  secretKeyRef:
                    key: preshared_key
                    name: dev-spicedb-config
              - name: SPICEDB_ENDPOINT
                value: relations-spicedb:50051
              - name: SPICEDB_SCHEMA_FILE
                value: /etc/schema/schema.zed
            volumes:
            - name: schema
              configMap:
                name: spicedb-schema
            - name: relations-api-config
              configMap:
                name: relations-api-config
            volumeMounts:
              - name: schema
                mountPath: /etc/schema
              - name: relations-api-config
                mountPath: /config
          webServices:
            public:
              enabled: true
              apiPath: authz
parameters:
  - description: ClowdEnvironment name (ephemeral, stage, prod)
    name: ENV_NAME
    required: true
  - description: App Image
    name: RELATIONS_IMAGE
    value: quay.io/redhat-services-prod/project-kessel-tenant/kessel-relations/relations-api
  - description: Image Tag
    name: RELATIONS_IMAGE_TAG
    value: latest
  - description: Number of pods for spiceDB service
    name: SPICEDB_REPLICAS
    value: '1'
  - description: Number of pods for relations service
    name: RELATIONS_REPLICAS
    value: '1'
  - description: SpiceDB Image
    name: SPICEDB_IMAGE
    value: quay.io/redhat-services-prod/project-kessel-tenant/kessel-relations/spicedb:latest
